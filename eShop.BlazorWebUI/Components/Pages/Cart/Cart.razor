@page "/shop/user-cart"

@inject ICartService CartService
@inject ILocalDataAccessor LocalDataAccessor
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

@if(UserCart is null)
{
    <MudGrid Justify="Justify.Center">
        <MudItem xs="12">
            <MudProgressCircular Color="Color.Primary" />
            <MudText Inline Typo="Typo.h4">Loading your cart. Please wait</MudText>
        </MudItem>
    </MudGrid>
}
else
{
    if(UserCart.GoodsCount > 0)
    {
        <MudGrid Justify="Justify.Center">
            <MudItem xs="12">
                <MudText Inline Typo="Typo.h4">Goods count: @UserCart.GoodsCount</MudText>
            </MudItem>
        </MudGrid>
    }
    else
    {
        <MudGrid Justify="Justify.Center">
            <MudItem xs="12">
                <MudText Inline Typo="Typo.h4">Your cart is empty</MudText>
            </MudItem>
        </MudGrid>
    }
}

@code {
    private CartDTO? UserCart;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var userId = await LocalDataAccessor.GetUserIdAsync();
        var response = await CartService.GetCartByUserIdAsync(Guid.Parse(userId));

        if (response.IsSucceeded)
        {
            UserCart = JsonConvert.DeserializeObject<CartDTO>(response.Result!.ToString()!)!;
        }
        else
        {
            Snackbar.Add(response.ErrorMessage, MudBlazor.Severity.Error);
        }
    }
}
