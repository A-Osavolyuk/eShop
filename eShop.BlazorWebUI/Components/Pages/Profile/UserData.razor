@page "/profile/user-data"
@using eShop.BlazorWebUI.Components.Shared

@inject IAuthenticationService AuthenticationService
@inject ITokenProvider TokenProvider

@layout ProfileLayout

<PageTitle>User Data</PageTitle>

<AuthorizeView Context="authContext">
    <Authorized>
        <MudGrid>
            <MudItem xs="12">
                <MudPaper Outlined Class="pa-3">
                    <LabeledText Label="First Name" TextContent="@model.FirstName" />
                    <LabeledText Label="Last Name" TextContent="@model.LastName" />
                    <LabeledText Label="Middle Name" TextContent="@model.MiddleName" />
                    <LabeledText Label="Gender" TextContent="@model.Gender" />
                    <LabeledText Label="Date of Birth" TextContent="@(model.DateOfBirth.ToLongDateString())" />
                    <LabeledText Label="Phone Number" TextContent="@model.PhoneNumber" />

                    <MudGrid>
                        <MudItem xs="12">
                            <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Primary"
                                       Size="Size.Large" StartIcon="@Icons.Material.Filled.ChangeCircle" OnClick="ShowChangeDataForm">
                                Change personal data
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </Authorized>
</AuthorizeView>



@code {
    [CascadingParameter]
    public Task<AuthenticationState> Context { get; set; }
    private PersonalDataDto model { get; set; } = new();
    private bool ShowDialog { get; set; } = false;

    override protected async Task OnInitializedAsync()
    {
        var state = await Context;
        var result = await AuthenticationService.
            GetPersonalDataAsync(state.User.Claims.FirstOrDefault(x => x.Type == CustomClaimTypes.Id).Value);

        if (result.IsSucceeded)
        {
            model = JsonConvert.DeserializeObject<PersonalDataDto>(result.Result!.ToString()!)!;
        }
    }

    private void ShowChangeDataForm()
    {

    }

}
